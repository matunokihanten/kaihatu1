<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šå±¤å›è»¢ç«‹æ–¹ä½“ãƒ‡ãƒ¢ - ãƒãƒ¼å‰Šæ¸›ç‰ˆ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            position: relative;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            max-width: 300px;
        }
        
        #info h2 {
            margin: 0 0 10px 0;
            font-size: 1.2em;
            color: #8be9fd; /* Accent color */
        }
        
        #info p {
            margin: 5px 0;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        #controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å°ã•ã */
            border-radius: 10px;
            backdrop-filter: blur(10px);
            z-index: 100;
            color: white;
            min-width: 125px; /* æœ€å°å¹…ã‚’åŠåˆ†ç¨‹åº¦ã« */
            max-width: 200px; /* æœ€å¤§å¹…ã‚‚è¨­å®šã—ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«åˆã‚ã›ã‚‹ */
        }
        
        .control-group {
            margin-bottom: 10px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’å°ã•ã */
        }
        
        .control-group label {
            display: block;
            margin-bottom: 3px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’å°ã•ã */
            font-size: 0.85em; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚‚å°‘ã—å°ã•ã */
            color: #8be9fd; /* Accent color */
        }
        
        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        
        .control-group input[type="range"]:hover {
            opacity: 1;
        }
        
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #8be9fd;
            cursor: pointer;
        }
        
        .control-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #8be9fd;
            cursor: pointer;
        }
        
        .control-group button {
            background: linear-gradient(45deg, #627ee7, #4b6cb7);
            border: none;
            color: white;
            padding: 6px 12px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å°ã•ã */
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚‚å°‘ã—å°ã•ã */
            transition: all 0.3s ease;
            margin-right: 5px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’å°ã•ã */
            margin-bottom: 5px;
        }
        
        .control-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.5em;
            z-index: 1000;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="loading">Three.jsã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        
        <div id="info">
            <h2>âœ¨ å¤šå±¤å›è»¢ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¢ (ãƒãƒ¼å‰Šæ¸›ç‰ˆ)</h2>
            <p>ğŸ“± <strong>æ“ä½œæ–¹æ³•:</strong></p>
            <p>â€¢ ãƒã‚¦ã‚¹/æŒ‡ã§ãƒ‰ãƒ©ãƒƒã‚°: è¦–ç‚¹å›è»¢</p>
            <p>â€¢ ãƒ›ã‚¤ãƒ¼ãƒ«/ãƒ”ãƒ³ãƒ: ã‚ºãƒ¼ãƒ </p>
            <p>â€¢ 5ç§’å¾Œã«è‡ªå‹•å›è»¢é–‹å§‹</p>
        </div>
        
        <div id="controls">
            <div class="control-group">
                <label>å›è»¢é€Ÿåº¦: <span id="speedValue">5.00</span></label>
                <input type="range" id="speedSlider" min="0" max="20" step="0.05" value="5.0">
            </div>
            
            <div class="control-group">
                <label>ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°: <span id="layersValue">30</span></label>
                <input type="range" id="layersSlider" min="10" max="100" step="1" value="30">
            </div>
            
            <div class="control-group">
                <label>å…¨ä½“ã‚¹ã‚±ãƒ¼ãƒ«: <span id="scaleValue">1.0</span></label>
                <input type="range" id="scaleSlider" min="0.5" max="2.0" step="0.05" value="1.0">
            </div>
            
            <div class="control-group">
                <button id="resetBtn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let scene, camera, renderer, controls;
        let mainObject; // å¤šå±¤ç«‹æ–¹ä½“ã®ã‚°ãƒ«ãƒ¼ãƒ—
        let autoRotationStarted = false;
        let rotationSpeed = 5.0; 
        let currentLayers = 30; 
        let currentScale = 1.0;

        // å›ºå®šå€¤ã¨ã—ã¦å®šç¾©
        const FIXED_DEPTH = 1.0;   // å‡¹ã¿æ·±ã•ã®å›ºå®šå€¤
        const FIXED_TWIST = 0.5;   // ã­ã˜ã‚Œåº¦ã®å›ºå®šå€¤

        // ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ (ã‚ˆã‚Šã¯ã£ãã‚Šã—ãŸè‰²ã«èª¿æ•´)
        const colorPalette = [
            new THREE.Color(0xFF0000), // èµ¤
            new THREE.Color(0xFF4500), // ã‚ªãƒ¬ãƒ³ã‚¸ãƒ¬ãƒƒãƒ‰ (ä»¥å‰ã‚ˆã‚Šé®®ã‚„ã‹ã«)
            new THREE.Color(0xFFD700), // ã‚´ãƒ¼ãƒ«ãƒ‰ (é®®ã‚„ã‹)
            new THREE.Color(0x32CD32), // ãƒ©ã‚¤ãƒ ã‚°ãƒªãƒ¼ãƒ³ (é®®ã‚„ã‹)
            new THREE.Color(0x00BFFF), // ãƒ‡ã‚£ãƒ¼ãƒ—ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼ (é®®ã‚„ã‹)
            new THREE.Color(0x4169E1), // ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ–ãƒ«ãƒ¼ (é®®ã‚„ã‹)
            new THREE.Color(0x9932CC), // ãƒ€ãƒ¼ã‚¯ã‚ªãƒ¼ã‚­ãƒƒãƒ‰ (é®®ã‚„ã‹)
            new THREE.Color(0xFF69B4), // ãƒ›ãƒƒãƒˆãƒ”ãƒ³ã‚¯ (é®®ã‚„ã‹)
            new THREE.Color(0xFFA07A), // ãƒ©ã‚¤ãƒˆã‚µãƒ¼ãƒ¢ãƒ³ (å°‘ã—å½©åº¦ã‚¢ãƒƒãƒ—)
            new THREE.Color(0x7B68EE), // ãƒŸãƒ‡ã‚£ã‚¢ãƒ ã‚¹ãƒ¬ãƒ¼ãƒˆãƒ–ãƒ«ãƒ¼ (é®®ã‚„ã‹)
            new THREE.Color(0x00FFFF)  // ã‚·ã‚¢ãƒ³ (é®®ã‚„ã‹)
        ];

        // åˆæœŸåŒ–
        function init() {
            // ã‚·ãƒ¼ãƒ³ä½œæˆ
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e); 

            // ã‚«ãƒ¡ãƒ©ä½œæˆ
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 20); 

            // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ä½œæˆ
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.outputEncoding = THREE.sRGBEncoding; 
            document.getElementById('container').appendChild(renderer.domElement);

            // OrbitControlsã®è¨­å®š
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; 
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false; 
            controls.minDistance = 5;
            controls.maxDistance = 50;

            // ãƒ©ã‚¤ãƒˆè¨­å®š
            setupLights();

            // å¤šå±¤ç«‹æ–¹ä½“ã‚’ä½œæˆ
            createLayeredObject();

            // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼è¨­å®š
            setupControls();

            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            setupEventListeners();

            // 5ç§’å¾Œã«è‡ªå‹•å›è»¢é–‹å§‹
            setTimeout(() => {
                autoRotationStarted = true;
            }, 5000);

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤º
            document.getElementById('loading').style.display = 'none';

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
            animate();
        }

        // ãƒ©ã‚¤ãƒˆè¨­å®š
        function setupLights() {
            // ç’°å¢ƒå…‰
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            // æŒ‡å‘æ€§ãƒ©ã‚¤ãƒˆ
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(20, 20, 20);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.height = 2048;
            scene.add(directionalLight);

            // ãƒã‚¤ãƒ³ãƒˆãƒ©ã‚¤ãƒˆ (è‰²ã«æ·±ã¿ã‚’ä¸ãˆã‚‹)
            const pointLight = new THREE.PointLight(0x627ee7, 0.5, 100);
            pointLight.position.set(-10, 10, -10);
            scene.add(pointLight);
        }

        // å¤šå±¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
        function createLayeredObject() {
            if (mainObject) {
                scene.remove(mainObject);
                // å­è¦ç´ ã®ã‚¸ã‚ªãƒ¡ãƒˆãƒªã¨ãƒãƒ†ãƒªã‚¢ãƒ«ã‚’ç ´æ£„ã—ã¦ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’é˜²ã
                mainObject.children.forEach(child => {
                    if (child.geometry) child.geometry.dispose();
                    if (child.material) {
                        if (Array.isArray(child.material)) {
                            child.material.forEach(m => m.dispose());
                        } else {
                            child.material.dispose(); // ç›´æ¥ãƒãƒ†ãƒªã‚¢ãƒ«ã‚’ç ´æ£„
                        }
                    }
                });
            }
            mainObject = new THREE.Group();

            const baseSize = 8; // æœ€å¤–å±¤ã®åŸºæœ¬ã‚µã‚¤ã‚º

            for (let i = 0; i < currentLayers; i++) {
                const normalizedIndex = i / (currentLayers - 1); // 0ã‹ã‚‰1ã®ç¯„å›²ã§æ­£è¦åŒ–

                // å‡¹ã¿ã‚’è¡¨ç¾ã™ã‚‹ãŸã‚ã®ã‚µã‚¤ã‚ºèª¿æ•´ (å›ºå®šå€¤ã‚’ä½¿ç”¨)
                let sizeFactor;
                if (normalizedIndex < 0.5) {
                    sizeFactor = 1 - Math.pow(normalizedIndex * 2, 2.5) * FIXED_DEPTH * 0.8; 
                } else {
                    sizeFactor = 1 - Math.pow((1 - normalizedIndex) * 2, 2.5) * FIXED_DEPTH * 0.8;
                }
                
                sizeFactor = Math.max(0.05, sizeFactor); // æœ€å°ã‚µã‚¤ã‚ºã‚’ä¿è¨¼

                const layerSize = baseSize * sizeFactor;

                // ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ (å¥¥è¡Œãæ„Ÿã¨å‡¹ã¿æ„Ÿã‚’å‡ºã™)
                const offset = (normalizedIndex - 0.5) * 2; 
                const layerPositionZ = offset * (baseSize / currentLayers / 2) * FIXED_DEPTH * 2; 

                // è‰²ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                const colorIndexFloat = normalizedIndex * (colorPalette.length - 1);
                const colorIndex1 = Math.floor(colorIndexFloat);
                const colorIndex2 = Math.ceil(colorIndexFloat);
                const lerpFactor = colorIndexFloat - colorIndex1;

                const color1 = colorPalette[colorIndex1];
                const color2 = colorPalette[colorIndex2];
                const interpolatedColor = new THREE.Color().lerpColors(color1, color2, lerpFactor);

                const geometry = new THREE.BoxGeometry(layerSize, layerSize, layerSize);
                const material = new THREE.MeshPhongMaterial({
                    color: interpolatedColor,
                    shininess: 150, 
                    transparent: true,
                    opacity: 0.3 + (0.6 * (1 - Math.abs(offset))) 
                });

                const layer = new THREE.Mesh(geometry, material);
                layer.position.z = layerPositionZ; 

                // å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã­ã˜ã‚Œã‚’åŠ ãˆã‚‹ (å›ºå®šå€¤ã‚’ä½¿ç”¨)
                layer.rotation.y = normalizedIndex * FIXED_TWIST * Math.PI * 2; 
                layer.rotation.x = normalizedIndex * FIXED_TWIST * Math.PI * 0.5; 

                layer.castShadow = true;
                layer.receiveShadow = true;
                mainObject.add(layer);
            }

            mainObject.scale.setScalar(currentScale); 
            scene.add(mainObject);
        }

        // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼è¨­å®š
        function setupControls() {
            // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
            document.getElementById('speedSlider').addEventListener('input', (e) => {
                rotationSpeed = parseFloat(e.target.value);
                document.getElementById('speedValue').textContent = rotationSpeed.toFixed(2);
            });

            document.getElementById('layersSlider').addEventListener('input', (e) => {
                currentLayers = parseInt(e.target.value);
                document.getElementById('layersValue').textContent = currentLayers;
                createLayeredObject(); 
            });

            document.getElementById('scaleSlider').addEventListener('input', (e) => {
                currentScale = parseFloat(e.target.value);
                document.getElementById('scaleValue').textContent = currentScale.toFixed(2);
                if (mainObject) {
                    mainObject.scale.setScalar(currentScale); 
                }
            });
            
            // ãƒœã‚¿ãƒ³
            document.getElementById('resetBtn').addEventListener('click', () => {
                // ã‚«ãƒ¡ãƒ©ã®ãƒªã‚»ãƒƒãƒˆ
                camera.position.set(0, 0, 20);
                controls.target.set(0, 0, 0);
                controls.update();

                // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«UIã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’åˆæœŸå€¤ã«æˆ»ã™
                document.getElementById('speedSlider').value = 5.0;
                rotationSpeed = 5.0;
                document.getElementById('speedValue').textContent = rotationSpeed.toFixed(2);

                document.getElementById('layersSlider').value = 30; 
                currentLayers = 30;
                document.getElementById('layersValue').textContent = currentLayers;

                document.getElementById('scaleSlider').value = 1.0;
                currentScale = 1.0;
                document.getElementById('scaleValue').textContent = currentScale.toFixed(2);

                createLayeredObject(); 
            });
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupEventListeners() {
            // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚º
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
        function animate() {
            requestAnimationFrame(animate);

            // è‡ªå‹•å›è»¢
            if (autoRotationStarted && mainObject) {
                mainObject.rotation.y += 0.005 * rotationSpeed;
            }

            // OrbitControlsã®æ›´æ–°ï¼ˆãƒ€ãƒ³ãƒ”ãƒ³ã‚°ã®ãŸã‚ï¼‰
            controls.update();

            // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
            renderer.render(scene, camera);
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        init();
    </script>
</body>
</html>
